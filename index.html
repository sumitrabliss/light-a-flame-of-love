<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light a Flame of Love | Global Resonance 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Montserrat:wght@100;200;300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --flame-amber: #f59e0b;
            --crystal-pink: #f472b6;
            --love-rose: #e11d48;
            --divine-gold: #fbbf24;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            transition: background-color 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            background-attachment: fixed;
            margin: 0;
            overflow-x: hidden;
        }

        h1, h2, h3, .font-fancy {
            font-family: 'Cinzel Decorative', cursive;
            letter-spacing: 0.15em;
        }

        /* --- Glassmorphism & Crystal Effects --- */
        .glass {
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        .dark .glass {
            background: rgba(8, 8, 14, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.07);
        }

        .crystal-border {
            position: relative;
            background-clip: padding-box;
            border: 1px solid transparent;
            border-radius: 3rem;
        }
        .crystal-border::before {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(255,255,255,0.7), rgba(251,191,36,0.4), rgba(244,114,182,0.4), rgba(255,255,255,0.7));
            background-size: 300% 300%;
            animation: borderRotate 12s linear infinite;
        }
        @keyframes borderRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Magical Flame Marker --- */
        .flame-marker {
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 50% 50%, #fff 0%, var(--divine-gold) 25%, var(--flame-amber) 55%, var(--love-rose) 100%);
            border-radius: 50% 50% 50% 50% / 65% 65% 35% 35%;
            box-shadow: 0 0 20px var(--flame-amber), 0 0 45px var(--divine-gold), 0 0 70px var(--love-rose);
            animation: flameBreath 3s infinite ease-in-out alternate;
            cursor: pointer;
        }
        @keyframes flameBreath {
            0% { transform: scale(0.7) translateY(0) rotate(-5deg); opacity: 0.6; }
            100% { transform: scale(1.4) translateY(-10px) rotate(5deg); opacity: 1; box-shadow: 0 0 35px var(--flame-amber), 0 0 75px var(--divine-gold), 0 0 120px var(--love-rose); }
        }

        .text-shimmer {
            background: linear-gradient(90deg, #fff, var(--divine-gold), #fff, var(--crystal-pink), #fff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmerText 8s linear infinite;
        }
        @keyframes shimmerText {
            to { background-position: 200% center; }
        }

        #map { height: 750px; width: 100%; border-radius: 3rem; z-index: 10; }
        
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(to bottom, var(--divine-gold), var(--love-rose)); 
            border-radius: 10px;
        }

        .crystal-popup .leaflet-popup-content-wrapper {
            background: rgba(10, 10, 25, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 2rem;
            color: white;
            padding: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .crystal-popup .leaflet-popup-tip { background: transparent; }

        .flicker { animation: flickerAnim 5s infinite alternate; }
        @keyframes flickerAnim {
            0%, 100% { opacity: 0.8; filter: brightness(1); }
            50% { opacity: 1; filter: brightness(1.3); transform: scale(1.02); }
        }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0/client",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="selection:bg-rose-500/30">
    <div id="root"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script type="module">
        import React, { createContext, useContext, useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';

        // --- CONFIGURATION ---
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzJHC7Rtm-A0yibWSy9mNz0Ofcd7TDOvcg6EVd383M9pdobQk6TO7PBLfk4B_-D614wtQ/exec";

        // --- Theme Management ---
        const ThemeContext = createContext();
        const ThemeProvider = ({ children }) => {
            const [theme, setTheme] = useState('dark');
            const toggleTheme = () => setTheme(prev => prev === 'light' ? 'dark' : 'light');
            useEffect(() => {
                document.documentElement.classList.toggle('dark', theme === 'dark');
            }, [theme]);
            return React.createElement(ThemeContext.Provider, { value: { theme, toggleTheme } }, children);
        };
        const useTheme = () => useContext(ThemeContext);

        // --- Geocoding Helper ---
        const geocode = async (location) => {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
                const data = await response.json();
                if (data && data.length > 0) {
                    return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };
                }
            } catch (e) { console.error("Geocoding failed", e); }
            return null;
        };

        // --- Header ---
        const Header = () => {
            const { theme, toggleTheme } = useTheme();
            return React.createElement('header', { className: 'sticky top-0 z-50 w-full glass border-b border-white/10 px-8 py-6 flex justify-between items-center backdrop-blur-3xl' },
                React.createElement('div', { className: 'flex items-center gap-6' },
                    React.createElement('div', { className: `relative w-12 h-12 rounded-full flex items-center justify-center transition-all duration-1000 ${theme === 'dark' ? 'bg-amber-500 shadow-[0_0_50px_rgba(245,158,11,0.8)]' : 'bg-indigo-600 shadow-[0_0_30px_rgba(79,70,229,0.3)]'}` },
                        React.createElement('div', { className: 'absolute inset-0 rounded-full animate-ping opacity-30 bg-current' }),
                        React.createElement('div', { className: 'w-5 h-5 rounded-full bg-white/95 blur-[1.5px]' })
                    ),
                    React.createElement('h1', { className: `text-2xl md:text-3xl font-fancy font-black tracking-[0.25em] ${theme === 'dark' ? 'text-white' : 'text-slate-900'}` }, 'LIGHT A FLAME OF LOVE')
                ),
                React.createElement('button', { onClick: toggleTheme, className: 'w-14 h-14 rounded-2xl glass crystal-border flex items-center justify-center transition-all shadow-xl hover:scale-110 active:scale-95 text-current' },
                    theme === 'dark' ? 
                        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-7 w-7 text-amber-400 flicker", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                            React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 1.5, d: "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M15 12a3 3 0 11-6 0 3 3 0 016 0z" })
                        ) :
                        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-7 w-7 text-indigo-700", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                            React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 1.5, d: "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" })
                        )
                )
            );
        };

        // --- App Logic ---
        const App = () => {
            const { theme } = useTheme();
            const [flames, setFlames] = useState([]);
            const [form, setForm] = useState({ name: '', email: '', location: '' });
            const [status, setStatus] = useState('idle'); // idle, loading, success

            const mapRef = useRef(null);
            const mapInstance = useRef(null);
            const markersLayer = useRef(null);

            // loadExistingFlames (GET)
            const loadExistingFlames = async () => {
                try {
                    const res = await fetch(GAS_URL);
                    const data = await res.json();
                    if (Array.isArray(data)) setFlames(data);
                } catch (e) { console.error("Sacred network retrieval failed", e); }
            };

            useEffect(() => {
                loadExistingFlames();
                const interval = setInterval(loadExistingFlames, 60000);
                return () => clearInterval(interval);
            }, []);

            // Map Initialization
            useEffect(() => {
                if (!mapRef.current) return;
                const map = L.map(mapRef.current, { center: [20, 0], zoom: 3, zoomControl: false, attributionControl: false });
                mapInstance.current = map;
                markersLayer.current = L.layerGroup().addTo(map);
                return () => map.remove();
            }, []);

            // Update Map Markers
            useEffect(() => {
                if (!mapInstance.current) return;
                const tileUrl = theme === 'dark' 
                    ? 'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png'
                    : 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png';
                L.tileLayer(tileUrl).addTo(mapInstance.current);

                if (markersLayer.current) {
                    markersLayer.current.clearLayers();
                    flames.forEach(f => {
                        if (f.lat && f.lng) {
                            const icon = L.divIcon({ 
                                className: '', 
                                html: '<div class="flame-marker"></div>', 
                                iconSize: [22, 22], 
                                iconAnchor: [11, 11] 
                            });
                            L.marker([f.lat, f.lng], { icon }).addTo(markersLayer.current)
                                .bindPopup(`
                                    <div class="text-center font-fancy p-4 min-w-[180px]">
                                        <span class="text-amber-500 font-bold text-xl drop-shadow-sm">${f.name}</span>
                                        <div class="h-px w-full bg-gradient-to-r from-transparent via-amber-500/40 to-transparent my-3"></div>
                                        <span class="text-[11px] opacity-70 uppercase tracking-[0.3em] font-black">${f.location}</span>
                                        <p class="text-[10px] mt-4 italic opacity-50 font-light">Divine Resonance Anchored</p>
                                    </div>
                                `, { className: 'crystal-popup' });
                        }
                    });
                }
            }, [theme, flames]);

            // Form Submit (POST)
            const handleSubmit = async (e) => {
                e.preventDefault();
                setStatus('loading');

                const coords = await geocode(form.location);
                if (!coords) {
                    alert("Divine location not found. Please try a more specific City and Country.");
                    setStatus('idle');
                    return;
                }

                const payload = { ...form, ...coords, timestamp: new Date().toISOString() };

                try {
                    // Send to Google Sheets (POST)
                    await fetch(GAS_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Optimistic UI Update
                    setFlames(prev => [...prev, payload]);
                    setStatus('success');
                    setForm({ name: '', email: '', location: '' });
                    
                    // Fly to the new anchor
                    mapInstance.current.flyTo([coords.lat, coords.lng], 8, { duration: 4 });

                    setTimeout(() => setStatus('idle'), 8000);
                } catch (e) {
                    console.error("The network of light is currently congested", e);
                    setStatus('idle');
                }
            };

            const inputClass = `w-full px-12 py-7 rounded-[3rem] glass border-0 outline-none transition-all focus:ring-2 focus:ring-amber-500/50 text-xl font-light ${theme === 'dark' ? 'text-white placeholder:text-white/10' : 'text-slate-800 placeholder:text-slate-400'}`;

            return React.createElement('div', { className: `min-h-screen transition-all ${theme === 'dark' ? 'bg-[#040406] text-white' : 'bg-[#fcfcfc] text-slate-900'}` },
                React.createElement(Header),
                React.createElement('main', { className: 'max-w-7xl mx-auto px-8 py-20 space-y-56' },
                    
                    // HERO SECTION
                    React.createElement('section', { className: 'text-center space-y-24 py-16' },
                        React.createElement('div', { className: 'inline-flex items-center gap-6 px-12 py-5 rounded-full border border-amber-500/50 glass bg-amber-500/5 text-amber-500 font-black text-[12px] tracking-[0.7em] uppercase shadow-[0_0_60px_rgba(245,158,11,0.25)] flicker' },
                            React.createElement('span', { className: 'w-4 h-4 rounded-full bg-amber-500 animate-ping' }),
                            'Imbolc 2026 • Leo Full Moon Awakening'
                        ),
                        React.createElement('div', { className: 'space-y-16' },
                            React.createElement('h1', { className: `text-7xl md:text-[10rem] font-fancy font-black leading-[0.8] tracking-tighter` }, 
                                'Ignite the ', React.createElement('br'), 
                                React.createElement('span', { className: 'text-shimmer drop-shadow-[0_0_50px_rgba(251,191,36,0.3)]' }, 'Sacred Flame')
                            ),
                            React.createElement('p', { className: 'max-w-5xl mx-auto text-3xl md:text-4xl font-extralight opacity-80 leading-relaxed tracking-wide italic' }, 
                                '"As the celestial moon reaches her zenith in Leo, we stand together as conduits for a love that knows no bounds. Your light is the missing thread in the tapestry of our collective awakening."'
                            )
                        ),
                        React.createElement('div', { className: 'flex flex-col sm:flex-row justify-center items-center gap-12 pt-16' },
                            React.createElement('a', { href: '#signup', className: 'px-24 py-8 rounded-full font-fancy font-black tracking-[0.4em] uppercase bg-gradient-to-r from-amber-400 via-rose-600 to-indigo-900 text-white shadow-[0_25px_80px_rgba(0,0,0,0.5)] transition-all transform hover:scale-110 active:scale-95' }, 'Anchor my light'),
                            React.createElement('a', { href: '#map-section', className: 'px-24 py-8 rounded-full font-fancy font-black tracking-[0.4em] uppercase border-2 border-current opacity-40 hover:opacity-100 transition-all hover:bg-current hover:text-black' }, 'Observe the web')
                        )
                    ),
                    
                    // MAP SECTION
                    React.createElement('section', { id: 'map-section', className: 'relative p-3 rounded-[4.5rem] crystal-border glass shadow-[0_60px_120px_rgba(0,0,0,0.6)]' },
                        React.createElement('div', { className: 'absolute top-14 left-14 z-[1000] glass px-12 py-5 rounded-full border border-white/10 flex items-center gap-6 shadow-2xl backdrop-blur-3xl' },
                            React.createElement('div', { className: 'w-4 h-4 rounded-full bg-emerald-500 animate-pulse' }),
                            React.createElement('span', { className: 'text-[13px] font-black tracking-[0.6em] uppercase opacity-70' }, 'Network Coherence: Resonant')
                        ),
                        React.createElement('div', { ref: mapRef, id: 'map' })
                    ),

                    // SIGNUP FORM SECTION
                    React.createElement('section', { id: 'signup', className: 'max-w-4xl mx-auto glass crystal-border p-20 md:p-36 space-y-20 shadow-2xl' },
                        status === 'success' ? 
                            React.createElement('div', { className: 'text-center py-28 space-y-12 animate-in fade-in zoom-in-95 duration-700' },
                                React.createElement('div', { className: "w-40 h-40 bg-gradient-to-tr from-amber-500 via-rose-600 to-indigo-900 rounded-full mx-auto flex items-center justify-center shadow-[0_0_100px_var(--flame-amber)] border-8 border-white/10" },
                                    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-20 w-20 text-white", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                                        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 3, d: "M5 13l4 4L19 7" })
                                    )
                                ),
                                React.createElement('div', { className: 'space-y-8' },
                                    React.createElement('h2', { className: 'text-6xl md:text-7xl font-fancy text-amber-500' }, 'Your Flame is Eternal'),
                                    React.createElement('p', { className: 'opacity-80 uppercase tracking-[0.5em] text-sm font-black' }, 'Harmonization Complete. You are part of the Great Shift.')
                                ),
                                React.createElement('button', { onClick: () => setStatus('idle'), className: 'text-amber-500 font-black uppercase tracking-[0.7em] text-[12px] mt-16 hover:tracking-[1.2em] transition-all' }, 'Light another flame?')
                            ) :
                            React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-16' },
                                React.createElement('div', { className: 'text-center mb-20' },
                                    React.createElement('h3', { className: 'text-6xl font-fancy text-shimmer leading-tight' }, 'Anchor Your Presence'),
                                    React.createElement('p', { className: 'text-[12px] font-black tracking-[0.7em] uppercase opacity-40 mt-8' }, 'Step into the Global Web of 2026')
                                ),
                                React.createElement('div', { className: 'space-y-6' },
                                    React.createElement('label', { className: 'text-[11px] uppercase tracking-[0.8em] font-black opacity-30 ml-10' }, 'Divine Name'),
                                    React.createElement('input', { required: true, placeholder: 'How are you known in the silence?', className: inputClass, value: form.name, onChange: e => setForm({...form, name: e.target.value}) })
                                ),
                                React.createElement('div', { className: 'space-y-6' },
                                    React.createElement('label', { className: 'text-[11px] uppercase tracking-[0.8em] font-black opacity-30 ml-10' }, 'Sacred Frequency'),
                                    React.createElement('input', { required: true, type: 'email', placeholder: 'yourname@consciousness.com', className: inputClass, value: form.email, onChange: e => setForm({...form, email: e.target.value}) })
                                ),
                                React.createElement('div', { className: 'space-y-6' },
                                    React.createElement('label', { className: 'text-[11px] uppercase tracking-[0.8em] font-black opacity-30 ml-10' }, 'Heart Origin'),
                                    React.createElement('input', { required: true, placeholder: 'City, Country', className: inputClass, value: form.location, onChange: e => setForm({...form, location: e.target.value}) })
                                ),
                                React.createElement('button', { type: 'submit', disabled: status === 'loading', className: 'w-full py-10 rounded-[3.5rem] bg-gradient-to-r from-amber-500 via-rose-600 to-indigo-950 text-white font-fancy font-black tracking-[0.7em] uppercase shadow-2xl transition-all transform hover:scale-[1.03] disabled:opacity-50 active:scale-95' },
                                    status === 'loading' ? 'Weaving the Frequency...' : 'IGNITE'
                                ),
                                React.createElement('p', { className: 'text-center text-[11px] uppercase tracking-[0.6em] opacity-30 italic pt-8' }, 'Your sovereignty is honored. Your data remains sacred.')
                            )
                    ),

                    // FUTURE VISION SECTION
                    React.createElement('section', { className: 'text-center space-y-32 pb-56' },
                        React.createElement('h2', { className: 'text-7xl md:text-9xl font-fancy text-shimmer leading-tight' }, 'A Resonating Collective'),
                        React.createElement('p', { className: 'max-w-6xl mx-auto text-4xl md:text-6xl font-extralight opacity-70 leading-relaxed tracking-wide' }, 
                            'When we collectively hold the frequency of peace, we provide a stabilizing field that ripples through the very fabric of existence.'
                        ),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-20 mt-40' },
                            [
                                { title: 'Unity', desc: 'Dissolving the illusion of separation into a singular resonant wave of pure love.', icon: 'M12 4v16m8-8H4' },
                                { title: 'Radiance', desc: 'Becoming the crystal lens through which the eternal light of truth illuminates the shadow.', icon: 'M12 3v1m0 16v1m9-9h-1M4 12H3' },
                                { title: 'Sovereignty', desc: 'Reclaiming the divine power of intention to heal, restore, and transform our reality.', icon: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z' }
                            ].map((item, idx) => React.createElement('div', { key: idx, className: 'group p-16 rounded-[4rem] glass crystal-border transition-all hover:-translate-y-6 hover:shadow-2xl' },
                                React.createElement('div', { className: 'w-24 h-24 rounded-[2.5rem] bg-gradient-to-tr from-amber-400/20 to-rose-500/20 flex items-center justify-center mx-auto mb-12 group-hover:scale-110 transition-transform shadow-lg' },
                                    React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: `h-12 w-12 ${theme === 'dark' ? 'text-amber-400' : 'text-indigo-800'}`, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                                        React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 1, d: item.icon })
                                    )
                                ),
                                React.createElement('h3', { className: 'text-3xl font-fancy mb-8 tracking-[0.3em] uppercase' }, item.title),
                                React.createElement('p', { className: 'text-base font-light leading-relaxed opacity-60' }, item.desc)
                            ))
                        )
                    )
                ),
                React.createElement('footer', { className: 'py-32 text-center opacity-40 border-t border-white/5 space-y-12' },
                    React.createElement('p', { className: 'font-fancy text-3xl tracking-[0.6em] font-black text-shimmer' }, 'LIGHT A FLAME OF LOVE'),
                    React.createElement('div', { className: 'flex justify-center gap-16 text-[12px] font-black uppercase tracking-[0.5em]' },
                        React.createElement('a', { href: '#', className: 'hover:text-amber-500 transition-colors' }, 'Instagram'),
                        React.createElement('a', { href: '#', className: 'hover:text-amber-500 transition-colors' }, 'Telegram'),
                        React.createElement('a', { href: '#', className: 'hover:text-amber-500 transition-colors' }, 'The Manifesto')
                    ),
                    React.createElement('p', { className: 'text-[11px] tracking-[0.9em] font-bold opacity-30 mt-8' }, 'ESTABLISHED FOR THE GREAT AWAKENING • 2026')
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(ThemeProvider, null, React.createElement(App)));
    </script>
</body>
</html>
